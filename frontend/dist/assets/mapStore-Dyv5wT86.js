import{r as n,ae as A}from"./index-C4UDD_tn.js";function I(){const u=n(!1),c=n(null),v=async o=>{if(!o.trim())return c.value="주소를 입력해주세요.",null;u.value=!0,c.value=null;try{const e=await r(o);return console.log("result",e),e||(c.value="주소를 찾을 수 없습니다.",null)}catch(e){return console.error("주소 검색 실패:",e),c.value="주소 검색 중 오류가 발생했습니다.",null}finally{u.value=!1}},r=async o=>{try{const e="C641EDC7-5746-3DFD-8D6A-2B7E23AF788D",a=await fetch(`https://api.vworld.kr/req/address?service=address&request=getcoord&format=json&crs=epsg:4326&key=${e}&type=ROAD&address=${encodeURIComponent(o)}`);if(!a.ok)return console.warn("vWorld API 응답 실패, Nominatim으로 fallback"),d(o);const s=await a.json();if(console.log("vWorld 도로명 주소 응답:",s),s.response?.status==="OK"&&s.response?.result?.point){const l=s.response.result.point,i=s.response.result;return{roadAddress:i.refined?.text||i.text||o,jibunAddress:i.refined?.text||i.text||o,lat:parseFloat(l.y),lng:parseFloat(l.x)}}const p=await fetch(`https://api.vworld.kr/req/address?service=address&request=getcoord&format=json&crs=epsg:4326&key=${e}&type=PARCEL&address=${encodeURIComponent(o)}`);if(p.ok){const l=await p.json();if(console.log("vWorld 지번 주소 응답:",l),l.response?.status==="OK"&&l.response?.result?.point){const i=l.response.result.point,f=l.response.result;return{roadAddress:f.refined?.text||f.text||o,jibunAddress:f.refined?.text||f.text||o,lat:parseFloat(i.y),lng:parseFloat(i.x)}}}return d(o)}catch(e){return console.error("vWorld 검색 실패, Nominatim으로 fallback:",e),d(o)}},d=async o=>{try{const e=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(o+" South Korea")}&limit=1&addressdetails=1`,{headers:{"User-Agent":"Climate-Risk-Dashboard"}});if(!e.ok)return console.warn("Nominatim API 응답 실패"),null;const a=await e.json();if(a&&a.length>0){const s=a[0];return{roadAddress:s.display_name,jibunAddress:s.display_name,lat:parseFloat(s.lat),lng:parseFloat(s.lon)}}return null}catch(e){return console.error("Nominatim 검색 실패:",e),null}};return{searching:u,error:c,searchAddress:v}}const j=A("map",()=>{const u=n(null),c=n(null),v=n(null),r=n(null),d=n(null),o=n("SSP1-2.6"),e=n(2030),a=n("flood"),s=n(!1),p=n(5);return{selectedRegion:u,hoveredRegion:c,currentLocation:v,mapInstance:r,selectedFacility:d,selectedScenario:o,selectedYear:e,exposureType:a,showRadiusCircle:s,radiusKm:p,setSelectedRegion:t=>{u.value=t},setHoveredRegion:t=>{c.value=t},setCurrentLocation:t=>{v.value=t},setMapInstance:t=>{r.value=t},flyToLocation:(t,y,R=15,m,h)=>{if(r.value){if(r.value.flyTo&&typeof r.value.flyTo=="function")try{r.value.flyTo({center:[y,t],zoom:R,pitch:m!==void 0?m:0,bearing:h!==void 0?h:0,duration:m!==void 0||h!==void 0?2e3:1e3,essential:!0});return}catch{}r.value.flyTo&&typeof r.value.flyTo=="function"&&r.value.flyTo([t,y],R,{duration:1,easeLinearity:.25})}},setSelectedFacility:t=>{d.value=t},setSelectedScenario:t=>{o.value=t},setSelectedYear:t=>{e.value=t},setExposureType:t=>{a.value=t},setShowRadiusCircle:(t,y=5)=>{s.value=t,p.value=y}}});export{j as a,I as u};
