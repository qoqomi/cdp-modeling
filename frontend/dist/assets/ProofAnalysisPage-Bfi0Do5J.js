import{k as J,d as we,l as ke,r as U,w as pe,c as i,m,p as t,a as n,g as S,F as L,h as B,b as l,f as P,t as y,n as ge,_ as Ae,Q as K,j,a0 as xe,a1 as Me,ac as De,i as Fe,q as fe,ai as Re,a3 as Se,ah as Ue,o as Qe,e as Oe,v as Ge,x as Ne,aj as Ye,u as We}from"./index-C4UDD_tn.js";import{C as Ve}from"./chevron-down-2k307sX2.js";import{F as Te}from"./file-text-BTffbXUU.js";import{a as se}from"./client-BJ5cnuOJ.js";/**
 * @license lucide-vue-next v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=J("ArrowLeftIcon",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-vue-next v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=J("BookOpenIcon",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-vue-next v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=J("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=J("ChevronUpIcon",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-vue-next v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=J("InfoIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-vue-next v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=J("LanguagesIcon",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]);/**
 * @license lucide-vue-next v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=J("LightbulbIcon",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-vue-next v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=J("ListIcon",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-vue-next v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=J("LoaderCircleIcon",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-vue-next v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=J("RefreshCwIcon",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-vue-next v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=J("SaveIcon",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-vue-next v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=J("TargetIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),nt={class:"flex items-center gap-3"},at={class:"flex-1 overflow-y-auto p-3 custom-scrollbar",style:{"min-height":"0",margin:"-2px","padding-left":"calc(0.75rem + 2px)","padding-right":"calc(0.75rem + 2px)","padding-top":"calc(0.75rem + 2px)","padding-bottom":"calc(0.75rem + 2px)"}},ot=["onClick"],rt={class:"text-sm font-semibold"},lt={key:0,class:"ml-3 space-y-1.5 mt-1"},it=["onClick"],ct=we({__name:"QuestionSidebar",props:{selectedQuestionId:{},questionStructure:{}},emits:["questionSelect"],setup(f,{emit:R}){const s=ke(),A=f,C=R,x=U(new Set),Y=()=>{const g=new Set;for(const Z of A.questionStructure)g.add(Z.number);x.value=g};pe(()=>A.questionStructure,()=>{Y()},{immediate:!0,deep:!0});const O=g=>{x.value.has(g)?x.value.delete(g):x.value.add(g)},W=g=>{C("questionSelect",g)};return(g,Z)=>(l(),i("div",{class:"flex flex-col h-full",style:m({backgroundColor:t(s).isDark?"rgba(17, 24, 39, 0.95)":t(s).theme.whiteAlpha[95],border:`1px solid ${t(s).theme.cardBorder}`,borderRadius:"1rem",boxShadow:t(s).theme.elevation.card,width:"280px",minWidth:"280px",overflow:"hidden"})},[n("div",{class:"flex-shrink-0 px-4 py-3",style:m({borderBottom:`1px solid ${t(s).theme.cardBorder}`,backgroundColor:t(s).isDark?"rgba(15, 23, 42, 0.8)":"rgba(249, 250, 251, 0.8)"})},[n("div",nt,[n("div",{class:"w-8 h-8 rounded-lg flex items-center justify-center",style:m({backgroundColor:t(s).theme.primaryAlpha[15],boxShadow:t(s).theme.elevation.icon})},[S(t(qe),{size:16,style:m({color:t(s).theme.primary})},null,8,["style"])],4),n("h3",{class:"text-sm font-bold tracking-wide",style:m({color:t(s).theme.textPrimary})}," 문항 목록 ",4)])],4),n("div",at,[(l(!0),i(L,null,B(f.questionStructure,(D,X)=>(l(),i("div",{key:X,class:"mb-3"},[n("button",{onClick:E=>O(D.number),class:"w-full px-3 py-2.5 text-left flex items-center justify-between mb-1.5 section-btn",style:m({backgroundColor:x.value.has(D.number)?t(s).theme.primaryAlpha[15]:t(s).isDark?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.02)",color:t(s).theme.textPrimary,borderRadius:"0.75rem",border:`1px solid ${x.value.has(D.number)?t(s).theme.cardBorder:"transparent"}`,boxShadow:x.value.has(D.number)?t(s).theme.elevation.input:"none",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)"})},[n("span",rt,y(D.number),1),S(t(Ve),{size:14,class:ge([{"rotate-180":x.value.has(D.number)},"transition-transform"]),style:m({color:t(s).theme.textSecondary})},null,8,["class","style"])],12,ot),x.value.has(D.number)?(l(),i("div",lt,[(l(!0),i(L,null,B(D.questions,(E,N)=>(l(),i("button",{key:N,onClick:q=>W(E.id),class:"w-full px-3 py-2 text-left text-xs question-btn",style:m({backgroundColor:f.selectedQuestionId===E.id?t(s).theme.primary:t(s).isDark?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.02)",color:f.selectedQuestionId===E.id?"white":t(s).theme.textSecondary,borderRadius:"0.5rem",border:`1px solid ${f.selectedQuestionId===E.id?t(s).theme.primary:"transparent"}`,boxShadow:f.selectedQuestionId===E.id?t(s).theme.elevation.button:"none",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)"})},y(E.number)+" "+y(E.shortTitle),13,it))),128))])):P("",!0)]))),128))])],4))}}),dt=Ae(ct,[["__scopeId","data-v-2741c003"]]),ut={class:"flex flex-col h-full"},pt={class:"flex items-center gap-3"},vt={class:"flex items-center gap-2"},mt={key:0,class:"w-full h-full"},ht=["src"],gt=["onClick"],yt={class:"space-y-4"},bt={key:0,class:"overflow-x-auto"},ft={class:"w-full text-sm border-collapse"},xt=["onUpdate:modelValue","onInput","onClick"],wt=["onUpdate:modelValue","onChange","onClick"],kt=["value"],At=["onClick"],_t=["value","checked","onChange"],Ct=["onClick"],Et={key:1},St=["value","onInput","onFocus","placeholder"],Tt={key:2},$t=["onUpdate:modelValue","onChange"],Dt={value:""},Rt=["value"],Qt={key:3},zt=["onClick"],It=["value","checked","onChange"],Lt=we({__name:"EditableDocumentViewer",props:{documentUrl:{},selectedQuestionId:{},showTranslation:{type:Boolean},documentSections:{},appliedAnswers:{},isFullView:{type:Boolean},activeSection:{}},emits:["questionSelect","save","applyAnswer","toggleTranslation","fullView"],setup(f,{emit:R}){const s=ke(),A=f,C=R,x=U(A.showTranslation||!1),Y=U(null),O=new Map;pe(()=>A.showTranslation,v=>{x.value=v||!1},{immediate:!0});const W=v=>Array.isArray(v)?v.length===0:v==null||String(v).trim()==="",g=v=>!!(A.isFullView&&W(v)),Z=(v,w)=>{v.value=w,"valueEn"in v&&(v.valueEn=w)},D=(v,w)=>{x.value?v.value=w:"valueEn"in v?v.valueEn=w:v.value=w},X=(v,w)=>{v.value=w,"valueEn"in v&&(v.valueEn=w)},E=(v,w)=>{Array.isArray(v.value)||(v.value=[]);const T=[...v.value],M=T.indexOf(w);M>=0?T.splice(M,1):T.push(w),v.value=T,"valueEn"in v&&(v.valueEn=[...T])},N=(v,w)=>{Array.isArray(v.value)||(v.value=[]);const T=[...v.value],M=T.indexOf(w);M>=0?T.splice(M,1):T.push(w),v.value=T,"valueEn"in v&&(v.valueEn=[...T])},q=(v,w)=>{w?O.set(v,w):O.delete(v)},oe=()=>{Y.value&&Y.value.scrollTo({top:0,behavior:"smooth"})},ee=v=>{const w=O.get(v),T=Y.value;if(w&&T){const M=w.offsetTop-T.offsetTop-16;T.scrollTo({top:Math.max(M,0),behavior:"smooth"})}},ie=()=>{oe(),C("fullView")};pe(()=>A.selectedQuestionId,v=>{v?ee(v):oe()});const re=K(()=>A.documentUrl?A.documentUrl.toLowerCase().endsWith(".pdf")||A.documentUrl.includes("application/pdf")||A.documentUrl.includes("blob:")&&A.documentUrl.includes("pdf"):!1),ce=K(()=>A.documentSections&&A.documentSections.length>0?A.documentSections:ve.value),de=K(()=>{const v=ce.value;return A.isFullView||!A.activeSection?v:v.filter(w=>w.number===A.activeSection)}),ve=U([{number:"2.2",title:"Does your organization have a process for identifying, assessing, and managing environmental dependencies and/or impacts?",description:"",questions:[{id:"q-2.2",number:"2.2",title:"Does your organization have a process for identifying, assessing, and managing environmental dependencies and/or impacts?",type:"table",tableHeaders:["Process in place","Dependencies and/or impacts evaluated in this process"],tableRows:[[{type:"select",value:"",options:["Yes","No"]},{type:"select",value:"",options:["Dependencies only","Impacts only","Both dependencies and impacts"]}]]},{id:"q-2.2.1",number:"2.2.1",title:"Does your organization have a process for identifying, assessing, and managing environmental risks and/or opportunities?",type:"table",tableHeaders:["Process in place","Risks and/or opportunities evaluated in this process","Is this process informed by the dependencies and/or impacts process?"],tableRows:[[{type:"select",value:"",options:["Yes","No"]},{type:"select",value:"",options:["Risks only","Opportunities only","Both risks and opportunities"]},{type:"select",value:"",options:["Yes","No"]}]]},{id:"q-2.2.2",number:"2.2.2",title:"Provide details of your organization's process for identifying, assessing, and managing environmental dependencies, impacts, risks, and/or opportunities.",type:"table",tableHeaders:["Environmental issue","Indicate which of dependencies, impacts, risks, and opportunities are covered by the process for this environmental issue","Value chain stages covered","Coverage","Supplier tiers covered","Type of assessment","Frequency of assessment"],tableRows:[[{type:"text",value:""},{type:"checkbox",value:[],options:["Climate change","Water security","Deforestation"]},{type:"checkbox",value:[],options:["Dependencies","Impacts","Risks","Opportunities"]},{type:"checkbox",value:[],options:["Direct operations","Upstream value chain","Downstream value chain"]},{type:"select",value:"",options:["Full","Partial"]},{type:"checkbox",value:[],options:["Tier 1 suppliers","Tier 2 suppliers"]},{type:"select",value:"",options:["Qualitative only","Quantitative only","Qualitative and quantitative"]},{type:"select",value:"",options:["Annually","Quarterly","Monthly"]}]]},{id:"q-2.2.2.16",number:"2.2.2.16",title:"Further details of process",type:"textarea",value:""}]}]),Q=v=>{C("questionSelect",v)},le=()=>{C("save")},me=()=>{x.value=!x.value,C("toggleTranslation")},he=v=>{if(v.type==="table"&&v.tableRows.length>0){const T=v.tableRows[0].map(M=>M.type==="checkbox"?{...M,value:[]}:M.type==="select"?{...M,value:M.options[0]||""}:{...M,value:""});v.tableRows.push(T)}};return(v,w)=>(l(),i("div",ut,[n("div",{class:"flex-shrink-0 px-6 py-4 flex items-center justify-between",style:m({borderBottom:`1px solid ${t(s).theme.cardBorder}`,backgroundColor:t(s).isDark?"rgba(15, 23, 42, 0.8)":"rgba(249, 250, 251, 0.8)"})},[n("div",pt,[n("div",{class:"w-8 h-8 rounded-lg flex items-center justify-center",style:m({backgroundColor:t(s).theme.primaryAlpha[15],boxShadow:t(s).theme.elevation.icon})},[S(t(Te),{size:16,style:m({color:t(s).theme.primary})},null,8,["style"])],4),n("h3",{class:"text-sm font-bold tracking-wide",style:m({color:t(s).theme.textPrimary})}," 문서 뷰어 ",4),n("button",{onClick:me,class:"text-xs px-3 py-1.5 flex items-center gap-1.5 toggle-btn",style:m({backgroundColor:x.value?t(s).theme.primary:t(s).theme.primaryAlpha[10],color:x.value?"white":t(s).theme.primary,borderRadius:"0.5rem",border:`1px solid ${x.value?t(s).theme.primary:t(s).theme.cardBorder}`,boxShadow:x.value?t(s).theme.elevation.button:t(s).theme.elevation.input})},[S(t(He),{size:14}),j(" "+y(x.value?"한국어":"English"),1)],4)]),n("div",vt,[n("button",{onClick:le,class:"text-xs px-4 py-2 flex items-center gap-1.5 font-semibold save-btn",style:m({backgroundColor:t(s).theme.primary,color:"white",borderRadius:"0.5rem",boxShadow:t(s).theme.elevation.button})},[S(t(tt),{size:14}),w[0]||(w[0]=j(" Save ",-1))],4),n("button",{onClick:ie,class:"text-xs px-3 py-2 view-btn",style:m({backgroundColor:t(s).theme.primaryAlpha[10],color:t(s).theme.primary,borderRadius:"0.5rem",border:`1px solid ${t(s).theme.cardBorder}`,boxShadow:t(s).theme.elevation.input})}," 전체 보기 ",4)])],4),n("div",{ref_key:"scrollContainer",ref:Y,class:"flex-1 overflow-y-auto p-6 custom-scrollbar",style:m([{"min-height":"0"},{backgroundColor:t(s).isDark?"rgba(15, 23, 42, 0.4)":"rgba(255, 255, 255, 0.5)"}])},[A.documentUrl&&re.value?(l(),i("div",mt,[n("iframe",{src:A.documentUrl,class:"w-full h-full border-0 rounded-lg",style:{"min-height":"800px"}},null,8,ht)])):(l(),i("div",{key:1,class:"max-w-4xl mx-auto",style:m({color:t(s).theme.textPrimary})},[(l(!0),i(L,null,B(de.value,(T,M)=>(l(),i("div",{key:M,class:"mb-8"},[n("div",{class:"mb-4 px-4 py-3 overflow-hidden",style:m({backgroundColor:t(s).isDark?"rgba(30, 41, 59, 0.8)":"rgba(241, 245, 249, 0.9)",borderRadius:"0.75rem",border:`1px solid ${t(s).theme.cardBorder}`,boxShadow:t(s).theme.elevation.input})},[n("h4",{class:"text-base font-bold mb-2",style:m({color:t(s).theme.textPrimary})},y(T.number)+" "+y(x.value?T.title:T.titleEn||T.title),5),T.description?(l(),i("p",{key:0,class:"text-sm",style:m({color:t(s).theme.textSecondary})},y(T.description),5)):P("",!0)],4),(l(!0),i(L,null,B(T.questions,(h,te)=>(l(),i("div",{key:te,class:"mb-6 p-4 transition-all cursor-pointer question-card",ref_for:!0,ref:$=>q(h.id,$),style:m({backgroundColor:t(s).isDark?"rgba(15, 23, 42, 0.6)":t(s).theme.whiteAlpha[95],border:`1px solid ${!A.isFullView&&f.selectedQuestionId===h.id?t(s).theme.primary:t(s).theme.cardBorder}`,borderRadius:"0.875rem",boxShadow:!A.isFullView&&f.selectedQuestionId===h.id?`0 0 0 2px ${t(s).theme.primaryAlpha[30]}, ${t(s).theme.elevation.card}`:t(s).theme.elevation.input}),onClick:$=>Q(h.id)},[n("div",{class:"mb-3 px-3 py-2.5 flex items-center justify-between overflow-hidden",style:m({backgroundColor:t(s).isDark?"rgba(30, 41, 59, 0.6)":"rgba(241, 245, 249, 0.8)",borderRadius:"0.5rem",boxShadow:"inset 0 1px 2px rgba(0, 0, 0, 0.04)"})},[n("h5",{class:"text-sm font-semibold",style:m({color:t(s).theme.textPrimary})},y(h.number)+" "+y(x.value?h.title:h.titleEn||h.title),5)],4),n("div",yt,[h.type==="table"?(l(),i("div",bt,[n("table",ft,[n("thead",null,[n("tr",{style:m({backgroundColor:t(s).isDark?"rgba(30, 41, 59, 0.8)":"rgba(241, 245, 249, 0.8)"})},[(l(!0),i(L,null,B(x.value?h.tableHeaders:h.tableHeadersEn||h.tableHeaders,($,F)=>(l(),i("th",{key:F,class:"px-4 py-2 text-left border",style:m({borderColor:t(s).theme.cardBorder,color:t(s).theme.textPrimary})},y($),5))),128))],4)]),n("tbody",null,[(l(!0),i(L,null,B(h.tableRows,($,F)=>(l(),i("tr",{key:F,class:"hover:bg-opacity-50",style:m({backgroundColor:F%2===0?t(s).isDark?"rgba(15, 23, 42, 0.4)":"rgba(255, 255, 255, 0.5)":"transparent"})},[(l(!0),i(L,null,B($,(k,ne)=>(l(),i("td",{key:ne,class:"px-4 py-2 border",style:m({borderColor:t(s).theme.cardBorder,color:t(s).theme.textPrimary,backgroundColor:"transparent",boxShadow:g(k.value)?"0 0 0 1px rgba(250, 204, 21, 0.75), 0 0 10px rgba(250, 204, 21, 0.55)":"none"})},[k.type==="text"?xe((l(),i("input",{key:0,"onUpdate:modelValue":V=>k.value=V,type:"text",class:"w-full px-2 py-1 rounded border-0 bg-transparent focus:outline-none focus:ring-2 focus:ring-emerald-500/30",style:m({color:t(s).theme.textPrimary}),onInput:V=>X(k,V.target.value),onClick:V=>Q(h.id)},null,44,xt)),[[Me,k.value]]):k.type==="select"?xe((l(),i("select",{key:1,"onUpdate:modelValue":V=>k.value=V,class:"w-full px-2 py-1 rounded border bg-transparent focus:outline-none focus:ring-2 focus:ring-emerald-500/30",style:m({backgroundColor:t(s).isDark?"rgba(15, 23, 42, 0.8)":"rgba(255, 255, 255, 0.8)",borderColor:t(s).theme.cardBorder,color:t(s).theme.textPrimary}),onChange:V=>X(k,V.target.value),onClick:V=>Q(h.id)},[(l(!0),i(L,null,B(k.optionsEn||k.options,(V,H)=>(l(),i("option",{key:H,value:k.optionsEn?.[H]||k.options[H]},y(x.value?k.options?.[H]||V:k.optionsEn?.[H]||V),9,kt))),128))],44,wt)),[[De,k.value]]):k.type==="checkbox"?(l(),i("div",{key:2,class:"space-y-1",onClick:V=>Q(h.id)},[(l(!0),i(L,null,B(k.optionsEn||k.options,(V,H)=>(l(),i("label",{key:H,class:"flex items-center gap-2 cursor-pointer"},[n("input",{type:"checkbox",value:k.optionsEn?.[H]||k.options[H],checked:k.value.includes(k.optionsEn?.[H]||k.options[H]),onChange:ue=>N(k,k.optionsEn?.[H]||k.options[H]),class:"rounded",style:m({accentColor:t(s).theme.primary})},null,44,_t),n("span",{class:"text-xs",style:m({color:t(s).theme.textPrimary})},y(x.value?k.options?.[H]||V:k.optionsEn?.[H]||V),5)]))),128))],8,At)):P("",!0)],4))),128))],4))),128))])]),n("button",{onClick:Fe($=>he(h),["stop"]),class:"mt-3 px-3 py-1.5 text-xs font-medium add-row-btn",style:m({backgroundColor:t(s).theme.primaryAlpha[10],color:t(s).theme.primary,borderRadius:"0.5rem",border:`1px solid ${t(s).theme.cardBorder}`,boxShadow:t(s).theme.elevation.input})}," + Add Row ",12,Ct)])):h.type==="textarea"?(l(),i("div",Et,[n("textarea",{value:x.value?h.value||"":h.valueEn||"",onInput:$=>D(h,$.target?.value),onFocus:$=>Q(h.id),rows:"6",class:"w-full px-4 py-3 resize-none focus:outline-none textarea-3d",style:m({backgroundColor:t(s).isDark?"rgba(15, 23, 42, 0.8)":t(s).theme.whiteAlpha[95],border:`1px solid ${g(x.value?h.value:h.valueEn)?"rgba(250, 204, 21, 0.9)":t(s).theme.cardBorder}`,borderRadius:"0.75rem",boxShadow:g(x.value?h.value:h.valueEn)?"0 0 0 2px rgba(250, 204, 21, 0.3), inset 0 1px 2px rgba(0, 0, 0, 0.04)":t(s).theme.elevation.input,color:t(s).theme.textPrimary}),placeholder:x.value?"답변을 입력하세요...":"Enter your answer..."},null,44,St)])):h.type==="select"?(l(),i("div",Tt,[xe(n("select",{"onUpdate:modelValue":$=>h.value=$,onChange:$=>Z(h,$.target?.value),class:"w-full px-4 py-2.5 focus:outline-none select-3d",style:m({backgroundColor:t(s).isDark?"rgba(15, 23, 42, 0.8)":t(s).theme.whiteAlpha[95],border:`1px solid ${g(h.value)?"rgba(250, 204, 21, 0.9)":t(s).theme.cardBorder}`,borderRadius:"0.75rem",boxShadow:g(h.valueEn)?"0 0 0 2px rgba(250, 204, 21, 0.3), inset 0 1px 2px rgba(0, 0, 0, 0.04)":t(s).theme.elevation.input,color:t(s).theme.textPrimary})},[n("option",Dt,y(x.value?"선택하세요":"Select"),1),(l(!0),i(L,null,B(h.optionsEn||h.options,($,F)=>(l(),i("option",{key:F,value:$},y(x.value&&h.options?.[F]||$),9,Rt))),128))],44,$t),[[De,h.value]])])):h.type==="checkbox"?(l(),i("div",Qt,[n("div",{class:"space-y-2",onClick:$=>Q(h.id)},[(l(!0),i(L,null,B(h.optionsEn||h.options,($,F)=>(l(),i("label",{key:F,class:"flex items-center gap-2 cursor-pointer"},[n("input",{type:"checkbox",value:$,checked:h.value.includes($),onChange:k=>E(h,$),class:"rounded",style:m({accentColor:t(s).theme.primary})},null,44,It),n("span",{class:"text-sm",style:m({color:t(s).theme.textPrimary})},y(x.value&&h.options?.[F]||$),5)]))),128))],8,zt)])):P("",!0)])],12,gt))),128))]))),128))],4))],4)]))}}),Pt=Ae(Lt,[["__scopeId","data-v-45ab126d"]]),Bt={class:"flex items-center gap-3"},Mt={class:"text-xs mt-0.5 text-white/60"},Ft={class:"flex items-center gap-1.5"},Vt={class:"flex-1 overflow-y-auto px-4 py-4 scrollbar-thin"},Ht={key:0,class:"mb-4 p-3 rounded-lg border bg-blue-500/10 border-blue-500/30"},jt={class:"flex items-start gap-2"},Kt={class:"flex-1 min-w-0"},Ut={class:"text-xs font-semibold mb-1 flex items-center gap-2 text-blue-400"},Ot={class:"px-1.5 py-0.5 rounded text-xs bg-blue-500/20"},Gt={class:"text-xs leading-relaxed text-white/80"},Nt={key:1,class:"mb-4"},Yt={class:"text-sm font-semibold mb-3 leading-relaxed text-white"},Wt={class:"flex flex-col gap-2 mb-4"},Jt={key:0,disabled:"",class:"w-full px-4 py-2.5 rounded-lg text-sm font-semibold flex items-center justify-center gap-2 opacity-50 bg-white/10 text-white"},Xt={key:0,class:"mt-4 space-y-4"},Zt={class:"rounded-lg border border-white/20 overflow-hidden bg-white/[0.03]"},qt={class:"flex items-center justify-between p-3 border-b border-white/10"},es={class:"flex items-center gap-1.5"},ts={class:"p-3 space-y-2"},ss={class:"text-xs text-white/60 mb-1.5"},ns={class:"flex items-center justify-between"},as={class:"text-sm font-medium text-white"},os=["onClick","disabled"],rs={key:0,class:"rounded-lg border border-white/20 overflow-hidden bg-white/[0.03]"},ls={class:"p-3"},is={class:"text-xs font-semibold mb-2 text-white/70 flex items-center gap-1.5"},cs={class:"text-xs text-white/70 leading-relaxed"},ds={key:1,class:"rounded-lg border border-white/20 overflow-hidden bg-white/[0.03]"},us={class:"p-3"},ps={class:"text-xs font-semibold mb-2 text-white/70 flex items-center gap-1.5"},vs={class:"space-y-1.5"},ms={class:"text-white/80"},hs={key:0,class:"ml-1"},gs={key:1,class:"mt-4 space-y-4"},ys={class:"flex items-center justify-between mb-2"},bs={class:"flex items-center justify-between p-3 border-b border-white/10"},fs={class:"text-xs font-semibold text-white/90"},xs=["disabled","onClick"],ws={class:"p-3 space-y-3"},ks={class:"text-xs font-semibold mb-2 text-white/70 flex items-center gap-1.5"},As={key:0,class:"space-y-2"},_s={class:"text-xs font-semibold mb-1.5 text-white/80"},Cs={class:"text-xs text-white/90 font-medium"},Es={key:0,class:"flex flex-wrap gap-1"},Ss={key:1,class:"space-y-2"},Ts={class:"text-xs font-semibold mb-1 text-white/80"},$s={class:"text-xs leading-relaxed text-white/70"},Ds={key:2},Rs={class:"text-xs leading-relaxed text-white/70 p-2 rounded bg-white/[0.03] whitespace-pre-wrap"},Qs={key:0},zs={class:"text-xs font-semibold mb-2 text-white/70 flex items-center gap-1.5"},Is={class:"space-y-1.5"},Ls={class:"text-white/70"},Ps={key:0,class:"text-white/50 ml-1"},Bs={key:1},Ms={class:"text-xs font-semibold mb-2 text-white/70 flex items-center gap-1.5"},Fs={class:"space-y-1.5"},Vs={class:"flex items-center justify-between mb-0.5"},Hs={class:"font-semibold text-white/80"},js={key:0,class:"px-1.5 py-0.5 rounded text-xs bg-purple-500/20 text-purple-400"},Ks={key:0,class:"text-white/50 text-xs mb-1"},Us={class:"italic text-white/60"},Os={key:2,class:"mt-3"},Gs={class:"text-xs font-semibold mb-2 text-white/70 flex items-center gap-1.5"},Ns={class:"flex flex-wrap gap-2"},Ys={key:3},Ws={class:"text-xs font-semibold mb-2 text-white/70 flex items-center gap-1.5"},Js={class:"p-2 rounded bg-white/[0.03] text-xs text-white/70 leading-relaxed"},Xs={key:2,class:"flex flex-col items-center justify-center h-full text-center py-12"},Zs={class:"flex gap-2"},qs=["disabled"],en=we({__name:"SunhatAIPanel",props:{selectedQuestion:{},generatedAnswers:{},appliedAnswerId:{},hideHeader:{type:Boolean}},emits:["generateAnswer","selectAnswer","close","toggleExpand"],setup(f,{emit:R}){const s=f,A=R,C=ke(),x=U(!0),Y=U(!1),O=U(!1),W=U(""),g=U(null),Z=K(()=>({backgroundColor:C.isDark?"#1a1a1a":"#2d2d2d",color:"#ffffff",borderRadius:"1rem",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:C.isDark?"0 20px 60px rgba(0, 0, 0, 0.5), 0 8px 25px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.05)":"0 20px 60px rgba(0, 0, 0, 0.15), 0 8px 25px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.1)"})),D=K(()=>({borderBottom:"1px solid rgba(255, 255, 255, 0.1)",backgroundColor:C.isDark?"rgba(26, 26, 26, 0.9)":"rgba(45, 45, 45, 0.9)"})),X=K(()=>({backgroundColor:C.theme.primary,color:"white",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2)"})),E=K(()=>({backgroundColor:W.value.trim()&&!Y.value?C.theme.primary:"rgba(255, 255, 255, 0.1)",color:"white"})),N=e=>({backgroundColor:e?C.theme.primary:"rgba(255, 255, 255, 0.1)",color:e?"white":"rgba(255, 255, 255, 0.8)"}),q=e=>{const o=s.appliedAnswerId===e;return{borderColor:o?C.theme.primary:"rgba(255, 255, 255, 0.2)",backgroundColor:o?"rgba(16, 185, 129, 0.1)":"rgba(255, 255, 255, 0.03)",boxShadow:o?`0 0 15px ${C.theme.primary}40`:"none"}},oe=e=>{const o=s.appliedAnswerId===e;return{backgroundColor:o?"rgba(16, 185, 129, 0.15)":C.theme.primary,color:o?C.theme.primary:"white",opacity:o?.95:1,cursor:o?"default":"pointer"}},ee=K(()=>{if(!s.selectedQuestion)return"2";const e=s.selectedQuestion.number.match(/^(\d+\.\d+)/);return e?e[1]:"2"}),ie=K(()=>s.generatedAnswers?.length?s.generatedAnswers.some(e=>{const o=e.content?.rows?.length,d=e.content?.detailedText?.trim();return o||d}):!1),re=K(()=>{const e=s.selectedQuestion?.type;return e==="table"||e==="select"}),ce=K(()=>{const e=s.selectedQuestion?.tableHeaders||s.selectedQuestion?.tableHeadersEn;return e&&e.length>0}),de=K(()=>s.selectedQuestion?O.value?s.selectedQuestion.tableHeaders||s.selectedQuestion.tableHeadersEn||[]:s.selectedQuestion.tableHeadersEn||s.selectedQuestion.tableHeaders||[]:[]),ve=K(()=>{if(!re.value||!Q.value.length)return[];const o=Q.value[0].content.rows||[],d=de.value;if(o.length>0&&Array.isArray(o[0]))return o[0].map((b,I)=>({header:d[I]||`항목 ${I+1}`,value:te(b),cellIdx:I,applied:!1}));const G=o[0];return o.length>0&&G?.cells?G.cells.map((b,I)=>({header:d[I]||`항목 ${I+1}`,value:te(b),cellIdx:I,applied:!1})):o.length>0&&d.length>0?h(o[0]).map((I,ae)=>({header:d[ae]||`항목 ${ae+1}`,value:te(I),cellIdx:ae,applied:!1})):[]}),Q=K(()=>{if(!s.generatedAnswers)return[];const e=s.generatedAnswers.filter(G=>{const b=G.content?.rows?.length,I=G.content?.detailedText?.trim();return b||I});console.log("validAnswers computed:",e),console.log("hasTableHeaders:",ce.value),console.log("selectedQuestion.tableHeaders:",s.selectedQuestion?.tableHeaders);const d=e[0]?.content?.rows?.[0];return d&&(console.log("First row data:",d),console.log("Is first row an array?",Array.isArray(d))),e}),le={"2.2":"이 문항은 조직이 환경 의존성 및 영향을 식별, 평가, 관리하는 프로세스를 보유하고 있는지 확인합니다. 'Yes'를 선택한 경우, 의존성과 영향 중 어느 것을 평가하는지 명시해야 합니다.","2.2.1":"환경 리스크 및 기회를 관리하는 프로세스의 존재 여부를 확인합니다. 이 프로세스가 의존성/영향 프로세스와 연계되어 있는지도 중요합니다.","2.2.2":"프로세스의 상세 내용을 제공해야 합니다. 환경 이슈별로 어떤 요소(의존성, 영향, 리스크, 기회)를 다루는지, 가치사슬 단계, 평가 유형 및 빈도를 명확히 기재하세요.","2.2.2.11":"위치 특정성은 사이트별, 지역별, 전역 중 선택할 수 있습니다. 데이터 센터나 특정 시설의 경우 사이트별 평가가 권장됩니다.","2.2.2.16":"프로세스의 추가 세부사항을 서술형으로 제공합니다. TCFD 권고사항 준수, 이중 중요성 통합, 리스크 분류 체계 등을 포함하면 좋습니다."},me=K(()=>{if(!s.selectedQuestion)return null;if(le[s.selectedQuestion.number])return le[s.selectedQuestion.number];const e=s.selectedQuestion.number.split(".");for(let o=e.length;o>0;o--){const d=e.slice(0,o).join(".");if(le[d])return le[d]}return null}),he=e=>O.value?e.insight||e.insightEn:e.insightEn||e.insight,v=e=>O.value?e.analysisKo||e.analysis:e.analysisEn||e.analysis,w=e=>O.value?e.detail||e.detailEn:e.detailEn||e.detail,T=e=>O.value?e.answerKo||e.answer:e.answerEn||e.answer,M=e=>O.value?e.detailedTextKo||e.detailedText:e.detailedTextEn||e.detailedText,h=e=>{if(console.log("getRowCells called with row:",e),Array.isArray(e))return console.log("Row is array, returning as-is:",e),e;if(e.cells&&Array.isArray(e.cells))return console.log("Row has cells property:",e.cells),e.cells;if(e.values&&Array.isArray(e.values))return console.log("Row has values property:",e.values),e.values;if(e.answer!==void 0||e.answerEn!==void 0){const o=e.answerEn||e.answer||e.answerKo||"";return console.log("Simple row format detected, returning answer:",o),[{type:"text",value:o}]}return console.log("Fallback: wrapping row as single cell"),[e]},te=e=>{if(console.log("formatCellValue called with:",e),e==null)return"";if(typeof e=="object"&&e!==null){const o=e.value??e.valueEn??e.valueKo??"";return console.log("formatCellValue extracted value:",o),Array.isArray(o)?o.join(", "):String(o)}return Array.isArray(e)?e.join(", "):String(e)},$=e=>de.value[e]||`항목 ${e+1}`,F=e=>typeof e=="object"&&e!==null?e.type||"text":Array.isArray(e)?"checkbox":"text",k=e=>{if(typeof e=="object"&&e!==null){const o=e.value??e.valueEn??e.valueKo??[];return Array.isArray(o)?o:[String(o)]}return Array.isArray(e)?e:[]},ne=e=>e.sources?.length?e.sources:e.evidence?.length?e.evidence:null,V=e=>{switch(e){case"keep":return"bg-gray-500/10";case"modify":return"bg-yellow-500/10";case"add":return"bg-green-500/10";case"delete":return"bg-red-500/10";default:return"bg-white/5"}},H=e=>{switch(e){case"keep":return"text-gray-400";case"modify":return"text-yellow-400";case"add":return"text-green-400";case"delete":return"text-red-400";default:return"text-white/70"}},ue=e=>{switch(e){case"keep":return"[유지]";case"modify":return"[수정]";case"add":return"[추가]";case"delete":return"[삭제]";default:return`[${e}]`}},ye=e=>({dependencies:"의존성",impacts:"영향",risks:"리스크",opportunities:"기회"})[e]||e,be=async e=>{s.selectedQuestion&&(Y.value=!0,g.value=null,A("generateAnswer",s.selectedQuestion.id,e))},r=()=>be(),a=e=>{const o=s.generatedAnswers?.find(d=>d.id===e);o&&(A("selectAnswer",e),g.value=o.content)},u=async()=>{if(!W.value.trim()||!s.selectedQuestion)return;Y.value=!0,g.value=null;const e=W.value;W.value="",A("generateAnswer",s.selectedQuestion.id,e)},p=U(new Set),c=e=>{if(!Q.value.length)return;p.value.add(e);const o=Q.value[0].id;A("selectAnswer",o)},_=()=>{if(!Q.value.length)return;ve.value.forEach((o,d)=>{p.value.add(d)});const e=Q.value[0].id;A("selectAnswer",e)},z=e=>p.value.has(e);return pe(()=>s.selectedQuestion?.id,()=>{O.value=!1,W.value="";const e=s.generatedAnswers||[];if(e.length>0){const o=s.appliedAnswerId?e.find(d=>d.id===s.appliedAnswerId):null;g.value=o?.content||e[0]?.content||null}else g.value=null},{immediate:!0}),pe(()=>s.generatedAnswers,e=>{if(e!==void 0&&(Y.value=!1),!(!s.selectedQuestion||!e?.length)){if(s.appliedAnswerId){const o=e.find(d=>d.id===s.appliedAnswerId);if(o){g.value=o.content;return}}g.value=e[0]?.content||null}},{deep:!0,immediate:!0}),pe(()=>s.selectedQuestion,e=>{e&&(g.value=null,Y.value=!1,p.value=new Set)}),(e,o)=>(l(),i("div",{class:"flex flex-col h-full overflow-hidden",style:m(Z.value)},[s.hideHeader?P("",!0):(l(),i("div",{key:0,class:"flex-shrink-0 px-4 py-3 flex items-center justify-between",style:m(D.value)},[n("div",Bt,[n("div",{class:"w-9 h-9 rounded-xl flex items-center justify-center font-bold text-lg",style:m(X.value)}," S ",4),n("div",null,[o[5]||(o[5]=n("div",{class:"text-xs font-semibold text-white"}," Sunny SE Shared Workspace ",-1)),n("div",Mt," > CDP 2025 (T... > "+y(ee.value),1)])]),n("div",Ft,[n("button",{class:"p-2 rounded-lg btn-header",onClick:o[0]||(o[0]=d=>A("toggleExpand"))},[x.value?(l(),fe(t(Xe),{key:1,size:16,class:"text-white/80"})):(l(),fe(t(Ve),{key:0,size:16,class:"text-white/80"}))]),n("button",{class:"p-2 rounded-lg btn-header",onClick:o[1]||(o[1]=d=>A("close"))},[S(t(Re),{size:16,class:"text-white/80"})])])],4)),n("div",Vt,[f.selectedQuestion&&me.value?(l(),i("div",Ht,[n("div",jt,[S(t(Ze),{size:16,class:"mt-0.5 flex-shrink-0 text-blue-400"}),n("div",Kt,[n("div",Ut,[o[6]||(o[6]=n("span",null,"CDP 가이드라인",-1)),n("span",Ot,y(f.selectedQuestion.number),1)]),n("p",Gt,y(me.value),1)])])])):P("",!0),f.selectedQuestion?(l(),i("div",Nt,[n("h3",Yt,y(f.selectedQuestion.title),1),n("div",Wt,[Y.value?(l(),i("button",Jt,[S(t(et),{size:16,class:"animate-spin"}),o[7]||(o[7]=j(" Generating your answer... ",-1))])):ie.value?(l(),i("button",{key:2,onClick:r,class:"w-full px-4 py-2.5 rounded-lg text-sm font-semibold transition-all hover:opacity-90 flex items-center justify-center gap-2 bg-white/10 text-white"},[S(t(Ce),{size:16}),o[9]||(o[9]=j(" Generate a different answer ",-1))])):(l(),i("button",{key:1,onClick:o[2]||(o[2]=d=>be()),class:"w-full px-4 py-2.5 rounded-lg text-sm font-semibold transition-all hover:opacity-90 flex items-center justify-center gap-2",style:m({backgroundColor:t(C).theme.primary,color:"white"})},[S(t(Se),{size:16}),o[8]||(o[8]=j(" Generate an answer ",-1))],4))]),ie.value&&re.value?(l(),i("div",Xt,[n("div",Zt,[n("div",qt,[n("div",es,[S(t(Se),{size:14,class:"text-yellow-400"}),o[10]||(o[10]=n("span",{class:"text-sm font-semibold text-white"},"AI 추천값",-1))]),n("button",{onClick:r,class:"text-xs px-2 py-1 rounded transition-colors flex items-center gap-1 bg-white/10 hover:bg-white/20 text-white/70"},[S(t(Ce),{size:12}),o[11]||(o[11]=j(" 다시 생성 ",-1))])]),n("div",ts,[(l(!0),i(L,null,B(ve.value,(d,G)=>(l(),i("div",{key:G,class:ge(["p-3 rounded-lg border transition-all",z(G)?"border-emerald-500/50 bg-emerald-500/10":"border-white/10 bg-white/[0.02]"])},[n("div",ss,y(d.header),1),n("div",ns,[n("span",as,y(d.value),1),n("button",{onClick:b=>c(G),class:ge(["px-2.5 py-1 rounded text-xs font-medium transition-all",z(G)?"bg-emerald-500/20 text-emerald-400 cursor-default":"bg-white/10 hover:bg-white/20 text-white/80"]),disabled:z(G)},y(z(G)?"적용됨":"적용"),11,os)])],2))),128)),n("button",{onClick:_,class:"w-full mt-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all flex items-center justify-center gap-2",style:m({backgroundColor:t(C).theme.primary,color:"white"})},[S(t(_e),{size:14}),o[12]||(o[12]=j(" 전체 적용 ",-1))],4)])]),Q.value[0]?.content.insight||Q.value[0]?.content.analysis?(l(),i("div",rs,[n("div",ls,[n("div",is,[S(t(Ie),{size:12}),o[13]||(o[13]=j(" 인사이트 ",-1))]),n("div",cs,y(he(Q.value[0].content)||v(Q.value[0].content)),1)])])):P("",!0),ne(Q.value[0]?.content)?.length?(l(),i("div",ds,[n("div",us,[n("div",ps,[S(t(ze),{size:12}),o[14]||(o[14]=j(" 근거 문서 ",-1))]),n("div",vs,[(l(!0),i(L,null,B(ne(Q.value[0]?.content),(d,G)=>(l(),i("div",{key:G,class:"text-xs text-white/60"},[n("span",ms,y(d.source||`Page ${d.page}`),1),d.page?(l(),i("span",hs,"p."+y(d.page),1)):P("",!0)]))),128))])])])):P("",!0)])):ie.value&&!re.value?(l(),i("div",gs,[n("div",ys,[o[15]||(o[15]=n("div",{class:"text-xs font-semibold text-white/80"},"AI 생성 답변",-1)),n("button",{onClick:o[3]||(o[3]=d=>O.value=!O.value),class:"text-xs px-2 py-1 rounded transition-colors flex items-center gap-1",style:m(N(O.value))},[S(t(He),{size:12}),j(" "+y(O.value?"한국어":"English"),1)],4)]),(l(!0),i(L,null,B(Q.value,(d,G)=>(l(),i("div",{key:d.id,class:"rounded-lg border transition-all hover:border-opacity-50 overflow-hidden",style:m(q(d.id))},[n("div",bs,[n("span",fs," 답변 "+y(G+1),1),n("button",{class:"px-3 py-1 rounded text-xs font-semibold transition-all flex items-center gap-1 flex-shrink-0",style:m(oe(d.id)),disabled:s.appliedAnswerId===d.id,onClick:Fe(b=>a(d.id),["stop"])},[S(t(_e),{size:12}),n("span",null,y(s.appliedAnswerId===d.id?"적용됨":"적용하기"),1)],12,xs)]),n("div",ws,[n("div",null,[n("div",ks,[S(t(Te),{size:12}),o[16]||(o[16]=j(" 답변 내용 ",-1))]),ce.value&&d.content.rows?.length?(l(),i("div",As,[(l(!0),i(L,null,B(d.content.rows,(b,I)=>(l(),i("div",{key:I,class:"space-y-2"},[(l(!0),i(L,null,B(h(b),(ae,$e)=>(l(),i("div",{key:$e,class:"p-2.5 rounded-lg bg-white/[0.03] border border-white/10"},[n("div",_s,y($($e)),1),n("div",Cs,[F(ae)==="checkbox"?(l(),i("div",Es,[(l(!0),i(L,null,B(k(ae),(je,Ke)=>(l(),i("span",{key:Ke,class:"px-2 py-0.5 rounded-full text-xs",style:m({backgroundColor:t(C).theme.primary+"20",color:t(C).theme.primary})},y(je),5))),128))])):F(ae)==="select"?(l(),i("span",{key:1,class:"px-2 py-0.5 rounded text-xs",style:m({backgroundColor:t(C).theme.primary+"20",color:t(C).theme.primary})},y(te(ae)),5)):(l(),i(L,{key:2},[j(y(te(ae)),1)],64))])]))),128))]))),128))])):d.content.rows?.length&&!ce.value?(l(),i("div",Ss,[(l(!0),i(L,null,B(d.content.rows,(b,I)=>(l(),i("div",{key:I,class:"p-2 rounded bg-white/[0.03]"},[n("div",Ts,y(b.number)+" - "+y(w(b)),1),n("p",$s,y(T(b)),1)]))),128))])):d.content.detailedText?.trim()?(l(),i("div",Ds,[n("p",Rs,y(M(d.content)),1)])):P("",!0)]),d.content.changes?.length?(l(),i("div",Qs,[n("div",zs,[S(t(Ce),{size:12}),o[17]||(o[17]=j(" 변경 사항 ",-1))]),n("div",Is,[(l(!0),i(L,null,B(d.content.changes,(b,I)=>(l(),i("div",{key:I,class:ge(["flex items-start gap-2 text-xs p-2 rounded",V(b.type)])},[n("span",{class:ge(["font-semibold flex-shrink-0",H(b.type)])},y(ue(b.type)),3),n("span",Ls,[j(y(b.new_text||b.text||b.old_text)+" ",1),b.evidence_page?(l(),i("span",Ps," (p."+y(b.evidence_page)+") ",1)):P("",!0)])],2))),128))])])):P("",!0),ne(d.content)?.length?(l(),i("div",Bs,[n("div",Ms,[S(t(ze),{size:12}),o[18]||(o[18]=j(" 근거 자료 ",-1))]),n("div",Fs,[(l(!0),i(L,null,B(ne(d.content),(b,I)=>(l(),i("div",{key:I,class:"p-2 rounded text-xs bg-white/[0.03] text-white/70"},[n("div",Vs,[n("div",Hs,y(b.source||`Page ${b.page}`),1),b.confidence?(l(),i("span",js,y(b.confidence.toFixed(2)),1)):P("",!0)]),b.relevance?(l(),i("div",Ks,y(b.relevance),1)):P("",!0),n("div",Us,y(b.excerpt),1)]))),128))])])):P("",!0),d.content.scoringElements?(l(),i("div",Os,[n("div",Gs,[S(t(st),{size:12}),o[19]||(o[19]=j(" 스코어링 요소 ",-1))]),n("div",Ns,[(l(!0),i(L,null,B(d.content.scoringElements,(b,I)=>(l(),i("span",{key:I,class:ge(["px-2 py-1 rounded text-xs flex items-center gap-1",b?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"])},[b?(l(),fe(t(_e),{key:0,size:10})):(l(),fe(t(Re),{key:1,size:10})),j(" "+y(ye(I)),1)],2))),128))])])):P("",!0),d.content.insight||d.content.analysis?(l(),i("div",Ys,[n("div",Ws,[S(t(Ie),{size:12}),o[20]||(o[20]=j(" AI 인사이트 ",-1))]),n("div",Js,y(he(d.content)||v(d.content)),1)])):P("",!0)])],4))),128))])):P("",!0)])):(l(),i("div",Xs,[S(t(Te),{size:48,class:"text-white/30"}),o[21]||(o[21]=n("p",{class:"mt-4 text-sm text-white/60"}," 문서에서 문항을 클릭하여 AI 답변을 생성하세요 ",-1))]))]),f.selectedQuestion&&g.value?(l(),i("div",{key:1,class:"flex-shrink-0 px-4 py-3 border-t border-white/10",style:m({backgroundColor:t(C).isDark?"#1a1a1a":"#2d2d2d"})},[o[22]||(o[22]=n("div",{class:"text-xs font-semibold mb-2 text-white/80"},"답변 수정 요청",-1)),n("div",Zs,[xe(n("textarea",{"onUpdate:modelValue":o[4]||(o[4]=d=>W.value=d),rows:"2",class:"flex-1 px-3 py-2 rounded-lg text-sm resize-none focus:outline-none focus:ring-2 bg-white/10 border border-white/20 text-white/90 placeholder-white/40",style:m({"--tw-ring-color":t(C).theme.primary}),placeholder:"추가적으로 반영할 내용을 입력하세요"},null,4),[[Me,W.value]]),n("button",{onClick:u,disabled:!W.value.trim()||Y.value,class:"px-4 py-2 rounded-lg text-sm font-semibold transition-all hover:opacity-90 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:m(E.value)},[S(t(Ue),{size:16})],12,qs)])],4)):P("",!0)],4))}}),Le=Ae(en,[["__scopeId","data-v-5ab23aaf"]]),Ee={generateAnswer:async f=>(await se.post("/cdp/generate-answer",f)).data,getGuide:async f=>(await se.get(`/cdp/guide/${f}`)).data,saveAnswer:async f=>(await se.post("/cdp/answers",f)).data,getAnswersByCompanyAndYear:async(f,R=2025)=>(await se.get(`/cdp/companies/${f}/answers`,{params:{year:R}})).data,getLatestAnswer:async(f,R,s=2025)=>{try{return(await se.get(`/cdp/companies/${f}/answers/${R}`,{params:{year:s}})).data}catch{return null}},getAnswerHistory:async f=>{try{return(await se.get(`/cdp/answers/${f}/history`)).data}catch{return null}},deleteAnswer:async f=>{await se.delete(`/cdp/answers/${f}`)},deleteAnswersByQuestion:async(f,R)=>{await se.delete(`/cdp/companies/${f}/answers/${R}`)},healthCheck:async()=>(await se.get("/cdp/health")).data,getAnswersByCompany:async f=>(await se.get(`/cdp/answers/${f}`)).data},tn={class:"flex flex-col gap-4 h-full w-full overflow-hidden",style:{"min-height":"0"}},sn={class:"flex-shrink-0 flex items-center justify-between"},nn={class:"flex-1 flex gap-4 overflow-hidden relative",style:{"min-height":"0"}},an={key:0,class:"2xl:hidden absolute inset-0 z-50 flex"},Pe="demo-company",Be=2025,on=we({__name:"ProofAnalysisPage",setup(f){const R=ke(),s=We(),A=Ge(),C=U(!1),x=U(window.innerWidth>=1536),Y=()=>{x.value=window.innerWidth>=1536,x.value&&(C.value=!1)};Qe(()=>{window.addEventListener("resize",Y)}),Oe(()=>{window.removeEventListener("resize",Y)});const O=K(()=>A.params.reportId),W=K(()=>`cdp_djsi_saved_state_${O.value}`),g=U(null),Z=U(!1),D=U({}),X=K(()=>g.value?[...D.value[g.value]||[]]:[]),E=U([]),N=U({}),q=U(null),oe=U(!1),ee=U([{id:"q-2.2",number:"2.2",title:"Does your organization have a process for identifying, assessing, and managing environmental dependencies and/or impacts?",shortTitle:"Environmental dependencies and impacts process",type:"table"},{id:"q-2.2.1",number:"2.2.1",title:"Does your organization have a process for identifying, assessing, and managing environmental risks and/or opportunities?",shortTitle:"Environmental risks and opportunities process",type:"table"},{id:"q-2.2.2",number:"2.2.2",title:"Provide details of your organization's process for identifying, assessing, and managing environmental dependencies, impacts, risks, and/or opportunities.",shortTitle:"Process details",type:"table"},{id:"q-2.2.2.11",number:"2.2.2.11",title:"Location-specificity used",shortTitle:"Location-specificity",type:"select"},{id:"q-2.2.2.16",number:"2.2.2.16",title:"Further details of process",shortTitle:"Further details",type:"textarea"},{id:"q-3.1",number:"3.1",title:"Describe your organization's climate-related governance and strategic planning process.",shortTitle:"Climate governance & strategy",type:"textarea"}]),ie=K(()=>{const r=c=>c?{id:c.id,number:c.number,shortTitle:c.shortTitle||c.title.substring(0,30)}:null,a=[r(ee.value.find(c=>c.id==="q-2.2")),r(ee.value.find(c=>c.id==="q-2.2.1")),r(ee.value.find(c=>c.id==="q-2.2.2"))].filter(Boolean),u=[r(ee.value.find(c=>c.id==="q-2.2.2.11")),r(ee.value.find(c=>c.id==="q-2.2.2.16"))].filter(Boolean),p=[r(ee.value.find(c=>c.id==="q-3.1"))].filter(Boolean);return[{number:"2.2",questions:a},{number:"2.2.2",questions:u},{number:"3.1",questions:p}]}),re=K(()=>g.value?w(g.value):null),ce=()=>{s.push({name:"proof"})},de=r=>{if(g.value=r,oe.value=!1,r){const a=E.value.find(u=>u.questions?.some(p=>p.id===r));a&&(q.value=a.number||null)}},ve=()=>{g.value=null,oe.value=!0},Q=(r=!1)=>{try{const a={documentSections:E.value,generatedAnswersByQuestion:D.value,appliedAnswers:N.value};localStorage.setItem(W.value,JSON.stringify(a)),console.log("Saving changes...",a),r&&alert("변경사항이 저장되었습니다.")}catch(a){console.error("Failed to save state",a),r&&alert("저장 중 오류가 발생했습니다.")}},le=async()=>{Q(!1),g.value&&await me(g.value),alert("변경사항이 저장되었습니다.")},me=async r=>{const a=w(r);if(a)try{const u={};a.type==="textarea"?(u.value=a.valueEn||a.value||"",u.valueKo=a.value||""):a.type==="table"&&a.tableRows?u.rows=a.tableRows:a.type==="select"&&(u.value=a.valueEn||a.value||"",u.valueKo=a.value||"");const p=N.value[r],c=X.value.find(o=>o.id===p),_=c?.content?.scoringElements||{dependencies:!1,impacts:!1,risks:!1,opportunities:!1},z={companyId:Pe,questionNumber:a.number||r.replace("q-",""),questionTitle:a.titleEn||a.title,questionType:a.type,year:Be,answerData:u,scoringElements:_,aiGenerated:!!p,insight:c?.content?.insight,insightEn:c?.content?.insightEn,evidence:c?.content?.sources,createdBy:"user"},e=await Ee.saveAnswer(z);e.success?console.log(`Answer saved: id=${e.answerId}, version=${e.version}`):console.error("Failed to save answer:",e.message)}catch(u){console.error("API save error:",u)}},he=()=>{console.log("Clearing localStorage cache..."),localStorage.removeItem(W.value),D.value={},N.value={},E.value=ue(),q.value=E.value[0]?.number||null,console.log("Cache cleared, reloaded fresh data")};typeof window<"u"&&(window.clearCdpCache=he,console.log("Debug: call window.clearCdpCache() to reset all data"));const v=()=>{try{const r=localStorage.getItem(W.value);if(r){const a=JSON.parse(r);E.value=a.documentSections||ue(),D.value=a.generatedAnswersByQuestion||{},N.value=a.appliedAnswers||{},console.log("Loaded from localStorage:",{sections:E.value.length,answers:Object.keys(D.value)})}else E.value=ue(),D.value={},N.value={},console.log("No saved state, using fresh mock data");E.value.length>0&&(q.value=E.value[0]?.number||null)}catch(r){console.error("Failed to load saved state",r),E.value=ue(),D.value={},N.value={},q.value=E.value[0]?.number||null}},w=r=>{for(const a of E.value){const u=a.questions.find(p=>p.id===r);if(u)return u}return null},T=async(r,a)=>{console.log("Generating answer for:",r,"feedback:",a);const u=w(r);if(!u){console.error("Question not found:",r);return}try{const p=await Ee.generateAnswer({companyId:"demo-company",questionNumber:u.number||r.replace("q-",""),questionTitle:u.title||u.titleEn||"",questionType:u.type,feedback:a});if(p.answers&&(p.answers.conservative||p.answers.aggressive)){const _=M(p,u.type);D.value={...D.value,[r]:_}}else{console.warn("Empty API response, using fallback mock data");const _=ye(r,u,a);D.value={...D.value,[r]:_}}}catch(p){console.error("CDP API 호출 실패:",p);const c=ye(r,u);D.value={...D.value,[r]:c}}},M=(r,a)=>{const u=[],p=Date.now(),c=r.answers;return c&&(c.conservative&&u.push({id:`answer-${p}-conservative`,type:"conservative",content:{rows:$(c.conservative.answerData),detailedText:F(c.conservative.answerData),detailedTextKo:F(c.conservative.answerData,"ko"),detailedTextEn:F(c.conservative.answerData,"en"),insight:r.insight?.summary||c.conservative.reasoning,insightEn:r.insight?.summary,evidence:r.evidence,confidence:h(c.conservative.expectedScore?.percentage),answerData:c.conservative.answerData,expectedScore:c.conservative.expectedScore,complianceTags:c.conservative.complianceTags,tagSummary:c.conservative.tagSummary,level:"conservative",reuseLevel:"SAFE",expectedScoreLevel:te(c.conservative.expectedScore?.level),sources:r.evidence?.map(_=>({source:_.source,excerpt:_.excerpt,page:_.page,relevance:_.layer||"",confidence:_.score||0}))}}),c.aggressive&&a==="textarea"&&u.push({id:`answer-${p}-aggressive`,type:"aggressive",content:{rows:$(c.aggressive.answerData),detailedText:F(c.aggressive.answerData),detailedTextKo:F(c.aggressive.answerData,"ko"),detailedTextEn:F(c.aggressive.answerData,"en"),insight:r.insight?.summary||c.aggressive.reasoning,insightEn:r.insight?.summary,evidence:r.evidence,confidence:h(c.aggressive.expectedScore?.percentage),answerData:c.aggressive.answerData,expectedScore:c.aggressive.expectedScore,complianceTags:c.aggressive.complianceTags,tagSummary:c.aggressive.tagSummary,level:"aggressive",reuseLevel:"NEW",expectedScoreLevel:te(c.aggressive.expectedScore?.level),sources:r.evidence?.map(_=>({source:_.source,excerpt:_.excerpt,page:_.page,relevance:_.layer||"",confidence:_.score||0}))}})),u},h=r=>r?r>=80?"high":r>=50?"medium":"low":"medium",te=r=>{if(!r)return;const a=r.toLowerCase();return a.includes("leadership")||a.includes("a")?"Leadership":a.includes("management")||a.includes("b")?"Management":a.includes("awareness")||a.includes("c")||a.includes("d")?"Awareness":"Management"},$=r=>{if(!r)return[];let a=[];if(Array.isArray(r.rows)?a=r.rows:Array.isArray(r)&&(a=r),a.length===0)return[];const u=a[0];return Array.isArray(u)?a:u?.cells&&Array.isArray(u.cells)?a.map(p=>p.cells):u?.values&&Array.isArray(u.values)?a.map(p=>p.values):a.map((p,c)=>p.detail||p.detailEn||p.answer?p:{number:p.number||`${c+1}`,detail:p.fieldKo||p.field||"",detailEn:p.field||p.fieldKo||"",answer:p.value||"",answerKo:p.valueKo||p.value||"",answerEn:p.value||""})},F=(r,a)=>r?a==="ko"?r.detailedTextKo||r.value_ko||r.textKo||"":a==="en"?r.detailedTextEn||r.value||r.textEn||r.text||"":r.detailedText||r.value||r.text||"":"",k=(r,a)=>{if(!g.value)return;const u=w(g.value);if(u){if(console.log("Applying answer:",r),console.log("To question:",u),u.type==="textarea")u.value=r.detailedTextKo||r.detailedText||"",u.valueEn=r.detailedTextEn||r.detailedText||"";else if(u.type==="table"&&r.rows?.length>0){const p=r.rows;u.tableRows||(u.tableRows=[]),p.forEach((c,_)=>{u.tableRows[_]?c.forEach((z,e)=>{if(u.tableRows[_][e]){const o=u.tableRows[_][e],d=z.value??z.valueEn??z.valueKo??"";Array.isArray(d)?(o.value=[...d],"valueEn"in o&&(o.valueEn=[...d])):(o.value=d,"valueEn"in o&&(o.valueEn=d)),console.log(`Applied cell[${_}][${e}]:`,d)}}):u.tableRows[_]=c.map(z=>({type:z.type||"text",value:Array.isArray(z.value)?[...z.value]:z.value||"",valueEn:Array.isArray(z.value)?[...z.value]:z.value||"",options:z.options||[],optionsEn:z.optionsEn||z.options||[]}))}),u.tableRows=[...u.tableRows.map(c=>[...c])]}else if(u.type==="select"&&r.rows?.length>0){const p=r.rows[0];u.value=p.answerKo||p.answer||"",u.valueEn=p.answerEn||p.answer||""}E.value=[...E.value],a&&(N.value={...N.value,[g.value]:a},Q(!1))}},ne=r=>{const a=X.value.find(u=>u.id===r);a&&g.value&&(k(a.content,r),Q(!1),alert("선택한 답변이 문항에 적용되었습니다."))},V=()=>{g.value=null},H=()=>{},ue=()=>[{number:"2.2",title:"환경 의존성 및 영향 관리 프로세스",titleEn:"Environmental Dependencies and Impacts Management Process",description:"",questions:[{id:"q-2.2",number:"2.2",title:"귀 조직은 환경 의존성 및/또는 영향을 식별, 평가 및 관리하는 프로세스를 보유하고 있습니까?",titleEn:"Does your organization have a process for identifying, assessing, and managing environmental dependencies and/or impacts?",type:"table",tableHeaders:["프로세스 구축 여부","이 프로세스에서 평가되는 의존성 및/또는 영향"],tableHeadersEn:["Process in place","Dependencies and/or impacts evaluated in this process"],tableRows:[[{type:"select",value:"",valueEn:"",options:["예","아니오"],optionsEn:["Yes","No"]},{type:"select",value:"",valueEn:"",options:["의존성만","영향만","의존성 및 영향 모두"],optionsEn:["Dependencies only","Impacts only","Both dependencies and impacts"]}]]},{id:"q-2.2.1",number:"2.2.1",title:"귀 조직은 환경 리스크 및/또는 기회를 식별, 평가 및 관리하는 프로세스를 보유하고 있습니까?",titleEn:"Does your organization have a process for identifying, assessing, and managing environmental risks and/or opportunities?",type:"table",tableHeaders:["프로세스 구축 여부","이 프로세스에서 평가되는 리스크 및/또는 기회","이 프로세스가 의존성 및/또는 영향 프로세스에 의해 정보를 제공받습니까?"],tableHeadersEn:["Process in place","Risks and/or opportunities evaluated in this process","Is this process informed by the dependencies and/or impacts process?"],tableRows:[[{type:"select",value:"",valueEn:"",options:["예","아니오"],optionsEn:["Yes","No"]},{type:"select",value:"",valueEn:"",options:["리스크만","기회만","리스크 및 기회 모두"],optionsEn:["Risks only","Opportunities only","Both risks and opportunities"]},{type:"select",value:"",valueEn:"",options:["예","아니오"],optionsEn:["Yes","No"]}]]},{id:"q-2.2.2",number:"2.2.2",title:"귀 조직의 환경 의존성, 영향, 리스크 및/또는 기회를 식별, 평가 및 관리하는 프로세스의 세부사항을 제공하십시오.",titleEn:"Provide details of your organization's process for identifying, assessing, and managing environmental dependencies, impacts, risks, and/or opportunities.",type:"table",tableHeaders:["환경 이슈","이 환경 이슈에 대한 프로세스에서 다루는 의존성, 영향, 리스크 및 기회","포함된 가치사슬 단계","커버리지","포함된 공급업체 계층","평가 유형","평가 빈도"],tableHeadersEn:["Environmental issue","Indicate which of dependencies, impacts, risks, and opportunities are covered","Value chain stages covered","Coverage","Supplier tiers covered","Type of assessment","Frequency of assessment"],tableRows:[[{type:"text",value:"",valueEn:""},{type:"checkbox",value:[],valueEn:[],options:["의존성","영향","리스크","기회"],optionsEn:["Dependencies","Impacts","Risks","Opportunities"]},{type:"checkbox",value:[],valueEn:[],options:["직접 운영","상류 가치사슬","하류 가치사슬"],optionsEn:["Direct operations","Upstream value chain","Downstream value chain"]},{type:"select",value:"",valueEn:"",options:["전체","부분"],optionsEn:["Full","Partial"]},{type:"checkbox",value:[],valueEn:[],options:["1차 공급업체","2차 공급업체"],optionsEn:["Tier 1 suppliers","Tier 2 suppliers"]},{type:"select",value:"",valueEn:"",options:["정성적만","정량적만","정성적 및 정량적"],optionsEn:["Qualitative only","Quantitative only","Qualitative and quantitative"]},{type:"select",value:"",valueEn:"",options:["연간","분기별","월별"],optionsEn:["Annually","Quarterly","Monthly"]}]]},{id:"q-2.2.2.11",number:"2.2.2.11",title:"사용된 위치 특정성",titleEn:"Location-specificity used",type:"select",value:"",valueEn:"",options:["사이트별","지역별","전역"],optionsEn:["Site-specific","Regional","Global"]},{id:"q-2.2.2.16",number:"2.2.2.16",title:"프로세스의 추가 세부사항",titleEn:"Further details of process",type:"textarea",value:"",valueEn:""}]},{number:"3.1",title:"기후 관련 거버넌스 및 전략",titleEn:"Climate-related governance and strategy",description:"",questions:[{id:"q-3.1",number:"3.1",title:"귀 조직의 기후 관련 거버넌스 및 전략 수립 프로세스를 설명하십시오.",titleEn:"Describe your organization's climate-related governance and strategic planning process.",type:"textarea",value:"",valueEn:""}]}],ye=(r,a,u)=>{const p=Date.now();if(console.log("generateAnswersForQuestion called for:",r),console.log("Question type:",a?.type),console.log("Question tableHeaders:",a?.tableHeaders),console.log("Question tableHeaders length:",a?.tableHeaders?.length),a?.type==="textarea"){const c=`우리 조직은 ${a.title||"해당 주제"}에 대해 체계적인 접근 방식을 취하고 있습니다. 환경적 의존성과 영향에 대한 평가 프로세스는 전사적으로 통합 운영되며, TCFD 권고사항과 이중 중요성(Double Materiality) 개념을 적용합니다.`,_=`Our organization takes a systematic approach to ${a.titleEn||a.title||"this topic"}. The assessment process for environmental dependencies and impacts is integrated across the organization, applying TCFD recommendations and the Double Materiality concept.`;return[{id:`answer-${p}-1`,content:{rows:[],detailedText:_,detailedTextKo:c,detailedTextEn:_,level:"conservative",confidence:"high",reuseLevel:"SAFE",expectedScoreLevel:"Management",scoringElements:{dependencies:!0,impacts:!0,risks:!1,opportunities:!1},changes:[{type:"keep",text:"체계적인 접근 방식",reason:"기존 내용 유지 - 2025년에도 적용 가능"}],sources:[{source:"SK Inc. 2025 Sustainability Report",excerpt:"Our integrated environmental management system addresses both dependencies and impacts...",page:45,relevance:"통합 환경관리 시스템 근거",confidence:3.421}],insight:"이 답변은 조직의 체계적인 접근 방식을 강조합니다. 보수적 접근으로 기존 내용을 유지합니다.",insightEn:"This answer emphasizes the organization's systematic approach with a conservative approach maintaining existing content."}},{id:`answer-${p}-2`,content:{rows:[],detailedText:_+" We conduct quarterly reviews and annual comprehensive assessments aligned with global best practices.",detailedTextKo:c+" 분기별 검토와 글로벌 모범 사례에 맞춘 연간 종합 평가를 실시합니다.",detailedTextEn:_+" We conduct quarterly reviews and annual comprehensive assessments aligned with global best practices.",level:"aggressive",confidence:"medium",reuseLevel:"NEW",expectedScoreLevel:"Leadership",scoringElements:{dependencies:!0,impacts:!0,risks:!0,opportunities:!0},changes:[{type:"add",text:"분기별 검토와 연간 종합 평가",reason:"Leadership 등급 달성을 위한 추가 내용",evidence_page:52}],sources:[{source:"SK Inc. 2025 Sustainability Report",excerpt:"Quarterly environmental performance reviews are conducted by the ESG Committee...",page:52,relevance:"분기별 검토 프로세스 근거",confidence:2.987}],insight:"이 답변은 정기적 검토와 글로벌 모범 사례를 강조하여 Leadership 등급 달성 가능성을 높입니다.",insightEn:"This answer emphasizes regular reviews and global best practices to increase Leadership level achievement potential."}}]}if(a?.type==="table"&&a?.tableHeaders?.length>0){console.log("==> Entering tableHeaders branch for multi-cell table");const c=a.tableHeadersEn||a.tableHeaders,_=a.tableRows?.[0]||[];console.log("Headers:",c),console.log("Template row:",_);const z=c.map((e,o)=>{const d=_[o],G=d?.type||"text",b=d?.optionsEn||d?.options||[];return G==="checkbox"?{type:"checkbox",value:b.slice(0,Math.min(2,b.length)),options:b}:G==="select"?{type:"select",value:b[0]||"Yes",options:b}:e.toLowerCase().includes("environmental issue")||e.toLowerCase().includes("환경 이슈")?{type:"text",value:"Climate change"}:{type:"text",value:""}});return console.log("Generated mockRow:",z),console.log("mockRow is array:",Array.isArray(z)),[{id:`answer-${p}-1`,content:{rows:[z],level:"conservative",confidence:"high",reuseLevel:"PARTIAL",expectedScoreLevel:"Leadership",scoringElements:{dependencies:!0,impacts:!0,risks:!0,opportunities:!1},changes:[{type:"keep",text:"Yes",reason:"기존 응답이 2025년에도 유효합니다."},{type:"modify",old_text:"Dependencies only",new_text:"Both dependencies and impacts",reason:"2025년 보고서에서 영향 평가 포함이 확인되었습니다.",evidence_page:43}],sources:[{source:"SK Inc. 2025 Sustainability Report",excerpt:"An integrated process is operated to identify environmental dependencies and impacts across all business units...",page:43,relevance:"프로세스 존재 및 통합 관리 근거",confidence:3.753},{source:"SK Inc. 2025 Annual Report",excerpt:"Environmental risk management is embedded in our strategic planning process...",page:87,relevance:"전략적 환경 리스크 관리 근거",confidence:2.891}],insight:"이 답변은 CDP 가이드라인에 맞춰 작성되었습니다. Leadership 등급 달성을 위해 의존성과 영향을 모두 평가하는 것이 권장됩니다.",insightEn:"This answer is aligned with CDP guidelines. Assessing both dependencies and impacts is recommended for Leadership level."}}]}if(console.log("==> Using default fallback (simple table/select)"),a?.type==="select"){const c=a.optionsEn?.[0]||a.options?.[0]||"Yes";return[{id:`answer-${p}-1`,content:{rows:[{number:a.number||"",detail:"선택 항목",detailEn:"Selected option",answer:c,answerKo:a.options?.[0]||"예",answerEn:c}],level:"conservative",confidence:"high",reuseLevel:"SAFE",expectedScoreLevel:"Management",changes:[{type:"keep",text:c,reason:"기존 선택값이 2025년에도 유효합니다."}],sources:[{source:"CDP 2025 Guidance",excerpt:"Organizations should select the most appropriate option based on their current practices...",page:12,relevance:"CDP 선택 가이드라인",confidence:2.5}],insight:"이 답변은 CDP 평가 기준에 부합합니다.",insightEn:"This answer aligns with CDP assessment criteria."}}]}return[{id:`answer-${p}-1`,content:{rows:[{number:a.number||"",detail:"답변",detailEn:"Answer",answer:"Yes",answerKo:"예",answerEn:"Yes"}],level:"conservative",confidence:"medium",reuseLevel:"PARTIAL",expectedScoreLevel:"Awareness",changes:[{type:"keep",text:"Yes",reason:"기본 응답값 유지"}],sources:[{source:"CDP 2025 Questionnaire Guide",excerpt:"Basic affirmative responses are acceptable for initial submissions...",page:5,relevance:"기본 응답 가이드",confidence:1.8}],insight:"이 답변은 CDP 평가 기준에 부합합니다.",insightEn:"This answer aligns with CDP assessment criteria."}}]};pe(()=>({documentSections:E.value,generatedAnswersByQuestion:D.value,appliedAnswers:N.value}),()=>{Q(!1)},{deep:!0});const be=async()=>{try{const r=await Ee.getAnswersByCompanyAndYear(Pe,Be);if(r&&r.length>0){console.log(`Loaded ${r.length} saved answers from API`);for(const a of r){const u=`q-${a.questionNumber}`,p=w(u);p&&a.answerData&&(p.type==="textarea"?(p.value=a.answerData.valueKo||a.answerData.value||"",p.valueEn=a.answerData.value||""):p.type==="table"&&a.answerData.rows?p.tableRows=a.answerData.rows:p.type==="select"&&(p.value=a.answerData.valueKo||a.answerData.value||"",p.valueEn=a.answerData.value||""),console.log(`Applied saved answer to ${u}`))}E.value=[...E.value]}}catch(r){console.error("Failed to load saved answers from API:",r)}};return Qe(async()=>{v(),await be()}),(r,a)=>(l(),i("div",tn,[n("div",sn,[n("button",{onClick:ce,class:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold transition-all hover:opacity-90",style:m({backgroundColor:(t(R).isDark,"rgba(16, 185, 129, 0.1)"),color:t(R).theme.primary})},[S(t(Je),{size:16}),a[4]||(a[4]=j(" 뒤로 가기 ",-1))],4),C.value?P("",!0):(l(),i("button",{key:0,onClick:a[0]||(a[0]=u=>C.value=!0),class:"2xl:hidden flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold transition-all hover:opacity-90",style:m({backgroundColor:t(R).isDark?"rgba(16, 185, 129, 0.2)":"rgba(16, 185, 129, 0.15)",color:t(R).theme.primary})},[S(t(Se),{size:16}),a[5]||(a[5]=j(" AI 답변 생성 ",-1))],4))]),n("div",nn,[S(dt,{"selected-question-id":g.value,"question-structure":ie.value,onQuestionSelect:de},null,8,["selected-question-id","question-structure"]),n("div",{class:"flex-1 rounded-xl border overflow-hidden flex flex-col",style:m({backgroundColor:t(R).isDark?"rgba(17, 24, 39, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:t(R).theme.cardBorder})},[S(Pt,{"document-url":null,"selected-question-id":g.value,"show-translation":Z.value,"document-sections":E.value,"applied-answers":N.value,"active-section":q.value,"is-full-view":oe.value,onQuestionSelect:de,onSave:le,onApplyAnswer:k,onToggleTranslation:a[1]||(a[1]=u=>Z.value=!Z.value),onFullView:ve},null,8,["selected-question-id","show-translation","document-sections","applied-answers","active-section","is-full-view"])],4),n("div",{class:"hidden 2xl:flex rounded-xl border overflow-hidden flex-col",style:m([{width:"340px","min-width":"300px","flex-shrink":"0","min-height":"0"},{borderColor:t(R).theme.cardBorder}])},[S(Le,{"selected-question":re.value,"generated-answers":X.value,"applied-answer-id":g.value&&N.value[g.value]||null,onGenerateAnswer:T,onSelectAnswer:ne,onClose:V,onToggleExpand:H},null,8,["selected-question","generated-answers","applied-answer-id"])],4),S(Ye,{name:"slide-panel"},{default:Ne(()=>[C.value&&!x.value?(l(),i("div",an,[n("div",{class:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:a[2]||(a[2]=u=>C.value=!1)}),n("div",{class:"absolute right-0 top-0 bottom-0 w-full max-w-md rounded-l-xl border-l overflow-hidden flex flex-col shadow-2xl",style:m({backgroundColor:t(R).isDark?"rgba(26, 26, 26, 1)":"rgba(45, 45, 45, 1)",borderColor:t(R).theme.cardBorder})},[S(Le,{"selected-question":re.value,"generated-answers":X.value,"applied-answer-id":g.value&&N.value[g.value]||null,onGenerateAnswer:T,onSelectAnswer:ne,onClose:a[3]||(a[3]=u=>C.value=!1),onToggleExpand:H},null,8,["selected-question","generated-answers","applied-answer-id"])],4)])):P("",!0)]),_:1})])]))}}),un=Ae(on,[["__scopeId","data-v-4f8cb6fc"]]);export{un as default};
